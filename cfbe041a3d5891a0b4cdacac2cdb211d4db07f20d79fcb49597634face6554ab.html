<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Felix Freebet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Login Page Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .login-box {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .login-title i {
            color: #4cc9f0;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #ccc;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4cc9f0;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .btn {
            display: inline-block;
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(76, 201, 240, 0.3);
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .error-message {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 4px solid #f44336;
            padding: 12px;
            margin-top: 15px;
            border-radius: 5px;
            display: none;
        }
        
        /* Admin Panel Styles */
        .admin-container {
            display: none;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
        }
        
        .logo i {
            color: #4cc9f0;
        }
        
        .logout-btn {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(244, 67, 54, 0.3);
        }
        
        /* Dashboard Stats */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-1 .stat-icon {
            background: linear-gradient(135deg, #4361ee, #4cc9f0);
        }
        
        .stat-2 .stat-icon {
            background: linear-gradient(135deg, #f72585, #b5179e);
        }
        
        .stat-3 .stat-icon {
            background: linear-gradient(135deg, #4cc9f0, #4895ef);
        }
        
        .stat-info h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            color: #ccc;
            font-size: 14px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            background: transparent;
            border: none;
            color: #ccc;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            text-align: center;
        }
        
        .tab-btn.active {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Form Styles */
        .form-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .form-title {
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-title i {
            color: #4cc9f0;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #ccc;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s;
            font-family: 'Poppins', sans-serif;
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4cc9f0;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .upload-area:hover {
            border-color: #4cc9f0;
            background: rgba(76, 201, 240, 0.05);
        }
        
        .upload-area i {
            font-size: 40px;
            color: #4cc9f0;
            margin-bottom: 10px;
        }
        
        .upload-area p {
            color: #ccc;
        }
        
        .image-preview {
            display: none;
            margin-top: 15px;
            text-align: center;
        }
        
        .image-preview img {
            max-width: 100px;
            max-height: 100px;
            border-radius: 10px;
            object-fit: cover;
        }
        
        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        }
        
        .btn-success:hover {
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
        }
        
        .btn-warning:hover {
            box-shadow: 0 10px 20px rgba(255, 152, 0, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f44336 0%, #c62828 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 10px 20px rgba(244, 67, 54, 0.3);
        }
        
        /* Table Styles */
        .table-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            overflow-x: auto;
        }
        
        .table-title {
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .table-title i {
            color: #4cc9f0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            color: #4cc9f0;
            font-weight: 600;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            vertical-align: middle;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .app-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-published {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .status-draft {
            background: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            color: white;
            font-size: 14px;
        }
        
        .edit-btn {
            background: rgba(33, 150, 243, 0.2);
            color: #2196F3;
        }
        
        .edit-btn:hover {
            background: rgba(33, 150, 243, 0.3);
        }
        
        .delete-btn {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }
        
        .delete-btn:hover {
            background: rgba(244, 67, 54, 0.3);
        }
        
        .publish-btn {
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
        }
        
        .publish-btn:hover {
            background: rgba(76, 175, 80, 0.3);
        }
        
        .unpublish-btn {
            background: rgba(255, 152, 0, 0.2);
            color: #FF9800;
        }
        
        .unpublish-btn:hover {
            background: rgba(255, 152, 0, 0.3);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #1a1a2e;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .close-modal {
            background: none;
            border: none;
            color: #ccc;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: #f44336;
        }
        
        .modal-body {
            margin-bottom: 25px;
            color: #ccc;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #4cc9f0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-stats {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .form-buttons {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-wrap: wrap;
            }
            
            th, td {
                padding: 10px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 480px) {
            .login-box {
                padding: 25px;
            }
            
            .form-container, .table-container {
                padding: 15px;
            }
            
            .admin-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .logout-btn {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="login-title">
                <i class="fas fa-lock"></i> Admin Access System
            </div>
            <div class="input-group">
                <label for="adminToken">Masukkan Token Admin</label>
                <input type="password" id="adminToken" placeholder="Token Admin">
            </div>
            <button id="loginBtn" class="btn">
                <i class="fas fa-sign-in-alt"></i> Masuk
            </button>
            <div id="errorMessage" class="error-message">
                Token salah! Silakan coba lagi.
            </div>
        </div>
    </div>
    
    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-container">
        <div class="container">
            <!-- Header -->
            <div class="admin-header">
                <div class="logo">
                    <i class="fas fa-crown"></i>
                    <span>Felix Freebet Admin</span>
                </div>
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
            
            <!-- Dashboard Stats -->
            <div class="dashboard-stats">
                <div class="stat-card stat-1">
                    <div class="stat-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalApps">0</h3>
                        <p>Total APK</p>
                    </div>
                </div>
                <div class="stat-card stat-2">
                    <div class="stat-icon">
                        <i class="fas fa-download"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="totalDownloads">0</h3>
                        <p>Total Downloads</p>
                    </div>
                </div>
                <div class="stat-card stat-3">
                    <div class="stat-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="topAppName">-</h3>
                        <p>Top APK</p>
                    </div>
                </div>
            </div>
            
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" data-tab="apkList">
                    <i class="fas fa-list"></i> Daftar APK
                </button>
                <button class="tab-btn" data-tab="addApk">
                    <i class="fas fa-plus-circle"></i> Tambah APK
                </button>
            </div>
            
            <!-- APK List Tab -->
            <div id="apkList" class="tab-content active">
                <div class="table-container">
                    <div class="table-title">
                        <i class="fas fa-table"></i> Daftar Aplikasi
                    </div>
                    <div class="loading" id="tableLoading">
                        <div class="spinner"></div>
                    </div>
                    <table id="appsTable" style="display: none;">
                        <thead>
                            <tr>
                                <th>Icon</th>
                                <th>Nama</th>
                                <th>Kategori</th>
                                <th>Downloads</th>
                                <th>Status</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="appsTableBody">
                            <!-- Data akan dimuat di sini -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Add/Edit APK Tab -->
            <div id="addApk" class="tab-content">
                <div class="form-container">
                    <div class="form-title">
                        <i class="fas fa-edit"></i> <span id="formTitle">Tambah APK Baru</span>
                    </div>
                    <form id="apkForm">
                        <input type="hidden" id="apkId" value="">
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nama_app">Nama App *</label>
                                <input type="text" id="nama_app" required>
                            </div>
                            <div class="form-group">
                                <label for="kategori">Kategori *</label>
                                <select id="kategori" required>
                                    <option value="">Pilih Kategori</option>
                                    <option value="HOT">HOT</option>
                                    <option value="NEW">NEW</option>
                                    <option value="TRENDING">TRENDING</option>
                                    <option value="GACOR">GACOR</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="rating">Rating (0-5) *</label>
                                <input type="number" id="rating" min="0" max="5" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label for="pembuat">Pembuat *</label>
                                <input type="text" id="pembuat" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ukuran_file">Ukuran File (MB) *</label>
                                <input type="text" id="ukuran_file" placeholder="Contoh: 120MB atau 1.5GB" required>
                            </div>
                            <div class="form-group">
                                <label for="tanggal_update">Tanggal Update *</label>
                                <input type="date" id="tanggal_update" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="deskripsi">Deskripsi *</label>
                            <textarea id="deskripsi" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="info_apk">Info APK</label>
                            <textarea id="info_apk"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="link_download">Link Download *</label>
                            <input type="url" id="link_download" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="image_icon">Upload Icon (Cloudinary)</label>
                            <div id="uploadArea" class="upload-area">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>Klik untuk upload icon aplikasi</p>
                                <p style="font-size: 12px; margin-top: 5px;">Format: JPG, PNG, maks 2MB</p>
                            </div>
                            <input type="file" id="imageFile" accept="image/*" style="display: none;">
                            <input type="hidden" id="image_icon" value="">
                            <div id="imagePreview" class="image-preview">
                                <img id="previewImage" src="" alt="Preview">
                                <p id="imageName"></p>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="status_publish">Status Publish</label>
                            <select id="status_publish">
                                <option value="true">Published</option>
                                <option value="false">Draft</option>
                            </select>
                        </div>
                        
                        <div class="form-buttons">
                            <button type="button" id="cancelBtn" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Batal
                            </button>
                            <button type="submit" id="submitBtn" class="btn btn-success">
                                <i class="fas fa-save"></i> Simpan APK
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i> Konfirmasi Hapus
                </div>
                <button class="close-modal" id="closeDeleteModal">&times;</button>
            </div>
            <div class="modal-body">
                Apakah Anda yakin ingin menghapus APK "<span id="deleteAppName"></span>"? Tindakan ini tidak dapat dibatalkan.
            </div>
            <div class="modal-footer">
                <button id="cancelDeleteBtn" class="btn btn-secondary">Batal</button>
                <button id="confirmDeleteBtn" class="btn btn-danger">Hapus</button>
            </div>
        </div>
    </div>
    
    <!-- Success Message -->
    <div id="successToast" style="position: fixed; bottom: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px 20px; border-radius: 10px; display: none; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
        <i class="fas fa-check-circle"></i> <span id="successMessage">Operasi berhasil!</span>
    </div>
    
    <script>
        // Token Admin
        const ADMIN_TOKEN = "XH92JCW61LAKE641CYAKE5194NVLS7194OVIEK8129MGLW7194OAKRJD9173KCIW7263ICNWMOE838";
        
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB4LXzb55K6weYiWrMm_bMkd4O0k0Q8w00",
            authDomain: "felixfreebet.firebaseapp.com",
            projectId: "felixfreebet",
            storageBucket: "felixfreebet.firebasestorage.app",
            messagingSenderId: "407789900601",
            appId: "1:407789900601:web:a23a8431ffd74e854f8ee8"
        };
        
        // Cloudinary Configuration
        const CLOUDINARY_CLOUD_NAME = "dddjueqrh";
        const CLOUDINARY_UPLOAD_PRESET = "gudang_gacor_preset";
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const analytics = firebase.analytics();
        
        // DOM Elements
        const loginPage = document.getElementById('loginPage');
        const adminPanel = document.getElementById('adminPanel');
        const adminTokenInput = document.getElementById('adminToken');
        const loginBtn = document.getElementById('loginBtn');
        const errorMessage = document.getElementById('errorMessage');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // Dashboard Elements
        const totalAppsEl = document.getElementById('totalApps');
        const totalDownloadsEl = document.getElementById('totalDownloads');
        const topAppNameEl = document.getElementById('topAppName');
        
        // Tab Elements
        const tabBtns = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Form Elements
        const apkForm = document.getElementById('apkForm');
        const formTitle = document.getElementById('formTitle');
        const apkIdInput = document.getElementById('apkId');
        const namaAppInput = document.getElementById('nama_app');
        const kategoriInput = document.getElementById('kategori');
        const ratingInput = document.getElementById('rating');
        const deskripsiInput = document.getElementById('deskripsi');
        const pembuatInput = document.getElementById('pembuat');
        const ukuranFileInput = document.getElementById('ukuran_file');
        const tanggalUpdateInput = document.getElementById('tanggal_update');
        const infoApkInput = document.getElementById('info_apk');
        const linkDownloadInput = document.getElementById('link_download');
        const imageIconInput = document.getElementById('image_icon');
        const statusPublishInput = document.getElementById('status_publish');
        const cancelBtn = document.getElementById('cancelBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        // Upload Elements
        const uploadArea = document.getElementById('uploadArea');
        const imageFileInput = document.getElementById('imageFile');
        const imagePreview = document.getElementById('imagePreview');
        const previewImage = document.getElementById('previewImage');
        const imageName = document.getElementById('imageName');
        
        // Table Elements
        const tableLoading = document.getElementById('tableLoading');
        const appsTable = document.getElementById('appsTable');
        const appsTableBody = document.getElementById('appsTableBody');
        
        // Modal Elements
        const deleteModal = document.getElementById('deleteModal');
        const closeDeleteModal = document.getElementById('closeDeleteModal');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const deleteAppName = document.getElementById('deleteAppName');
        
        // Success Toast
        const successToast = document.getElementById('successToast');
        const successMessage = document.getElementById('successMessage');
        
        // State Variables
        let isEditMode = false;
        let deleteId = null;
        let apps = [];
        
        // Check if already logged in
        function checkLoginStatus() {
            const token = sessionStorage.getItem('adminToken');
            if (token === ADMIN_TOKEN) {
                loginPage.style.display = 'none';
                adminPanel.style.display = 'block';
                initializeAdminPanel();
            }
        }
        
        // Login Function
        function login() {
            const token = adminTokenInput.value.trim();
            
            if (token === ADMIN_TOKEN) {
                // Save token to sessionStorage
                sessionStorage.setItem('adminToken', token);
                
                // Hide login page, show admin panel
                loginPage.style.display = 'none';
                adminPanel.style.display = 'block';
                
                // Initialize admin panel
                initializeAdminPanel();
                
                // Log analytics event
                analytics.logEvent('admin_login');
            } else {
                // Show error
                errorMessage.style.display = 'block';
                adminTokenInput.style.borderColor = '#f44336';
                
                // Shake animation
                loginBox = document.querySelector('.login-box');
                loginBox.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    loginBox.style.animation = '';
                }, 500);
            }
        }
        
        // Logout Function
        function logout() {
            sessionStorage.removeItem('adminToken');
            location.reload();
        }
        
        // Initialize Admin Panel
        function initializeAdminPanel() {
            // Load dashboard stats
            loadDashboardStats();
            
            // Load apps table
            loadAppsTable();
            
            // Setup event listeners for tabs
            setupTabs();
            
            // Setup form event listeners
            setupForm();
            
            // Setup upload functionality
            setupUpload();
            
            // Setup modal event listeners
            setupModals();
        }
        
        // Load Dashboard Statistics
        function loadDashboardStats() {
            db.collection('apps').onSnapshot((snapshot) => {
                let totalApps = 0;
                let totalDownloads = 0;
                let topApp = null;
                let maxDownloads = 0;
                
                snapshot.forEach((doc) => {
                    const app = doc.data();
                    totalApps++;
                    totalDownloads += (app.download_count || 0);
                    
                    if ((app.download_count || 0) > maxDownloads) {
                        maxDownloads = app.download_count || 0;
                        topApp = app.nama_app;
                    }
                });
                
                totalAppsEl.textContent = totalApps;
                totalDownloadsEl.textContent = totalDownloads;
                topAppNameEl.textContent = topApp || '-';
            });
        }
        
        // Load Apps Table
        function loadAppsTable() {
            tableLoading.style.display = 'flex';
            appsTable.style.display = 'none';
            
            db.collection('apps').orderBy('created_at', 'desc').onSnapshot((snapshot) => {
                apps = [];
                appsTableBody.innerHTML = '';
                
                snapshot.forEach((doc) => {
                    const app = doc.data();
                    app.id = doc.id;
                    apps.push(app);
                    
                    const row = document.createElement('tr');
                    
                    // Format date
                    let tanggalUpdate = '-';
                    if (app.tanggal_update) {
                        const date = app.tanggal_update.toDate ? app.tanggal_update.toDate() : new Date(app.tanggal_update);
                        tanggalUpdate = date.toLocaleDateString('id-ID');
                    }
                    
                    row.innerHTML = `
                        <td>
                            ${app.image_icon ? 
                                `<img src="${app.image_icon}" alt="${app.nama_app}" class="app-icon">` : 
                                `<div class="app-icon" style="background: rgba(76, 201, 240, 0.2); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-mobile-alt" style="color: #4cc9f0;"></i>
                                </div>`
                            }
                        </td>
                        <td>${app.nama_app}</td>
                        <td>
                            <span style="padding: 3px 8px; background: rgba(76, 201, 240, 0.1); border-radius: 5px; font-size: 12px;">
                                ${app.kategori || '-'}
                            </span>
                        </td>
                        <td>${app.download_count || 0}</td>
                        <td>
                            <span class="status-badge ${app.status_publish ? 'status-published' : 'status-draft'}">
                                ${app.status_publish ? 'Published' : 'Draft'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-id="${app.id}" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" data-id="${app.id}" title="Hapus">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="action-btn ${app.status_publish ? 'unpublish-btn' : 'publish-btn'}" data-id="${app.id}" title="${app.status_publish ? 'Unpublish' : 'Publish'}">
                                    <i class="fas ${app.status_publish ? 'fa-eye-slash' : 'fa-eye'}"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    appsTableBody.appendChild(row);
                });
                
                tableLoading.style.display = 'none';
                appsTable.style.display = 'table';
                
                // Add event listeners to action buttons
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.getAttribute('data-id');
                        editApp(id);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.getAttribute('data-id');
                        const app = apps.find(a => a.id === id);
                        if (app) {
                            showDeleteModal(id, app.nama_app);
                        }
                    });
                });
                
                document.querySelectorAll('.publish-btn, .unpublish-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const id = e.currentTarget.getAttribute('data-id');
                        togglePublishStatus(id);
                    });
                });
            });
        }
        
        // Setup Tabs
        function setupTabs() {
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active class from all tabs
                    tabBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    btn.classList.add('active');
                    const tabId = btn.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // Setup Form
        function setupForm() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            tanggalUpdateInput.value = today;
            
            // Form submit
            apkForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveApp();
            });
            
            // Cancel button
            cancelBtn.addEventListener('click', () => {
                resetForm();
                switchToTab('apkList');
            });
        }
        
        // Setup Upload
        function setupUpload() {
            // Click on upload area triggers file input
            uploadArea.addEventListener('click', () => {
                imageFileInput.click();
            });
            
            // Handle file selection
            imageFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Validate file size (max 2MB)
                    if (file.size > 2 * 1024 * 1024) {
                        showToast('Ukuran file maksimal 2MB', 'error');
                        return;
                    }
                    
                    // Validate file type
                    const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
                    if (!validTypes.includes(file.type)) {
                        showToast('Format file harus JPG atau PNG', 'error');
                        return;
                    }
                    
                    // Show preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        previewImage.src = e.target.result;
                        imageName.textContent = file.name;
                        imagePreview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                    
                    // Upload to Cloudinary
                    uploadToCloudinary(file);
                }
            });
        }
        
        // Upload to Cloudinary
        function uploadToCloudinary(file) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
            formData.append('cloud_name', CLOUDINARY_CLOUD_NAME);
            
            // Show loading state
            uploadArea.innerHTML = '<i class="fas fa-spinner fa-spin"></i><p>Mengupload...</p>';
            
            fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.secure_url) {
                    imageIconInput.value = data.secure_url;
                    showToast('Icon berhasil diupload!', 'success');
                    
                    // Restore upload area
                    uploadArea.innerHTML = `
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Klik untuk upload icon aplikasi</p>
                        <p style="font-size: 12px; margin-top: 5px;">Format: JPG, PNG, maks 2MB</p>
                    `;
                } else {
                    showToast('Gagal mengupload icon', 'error');
                }
            })
            .catch(error => {
                console.error('Error uploading to Cloudinary:', error);
                showToast('Gagal mengupload icon', 'error');
                
                // Restore upload area
                uploadArea.innerHTML = `
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Klik untuk upload icon aplikasi</p>
                    <p style="font-size: 12px; margin-top: 5px;">Format: JPG, PNG, maks 2MB</p>
                `;
            });
        }
        
        // Setup Modals
        function setupModals() {
            // Delete modal
            closeDeleteModal.addEventListener('click', () => {
                deleteModal.style.display = 'none';
            });
            
            cancelDeleteBtn.addEventListener('click', () => {
                deleteModal.style.display = 'none';
            });
            
            confirmDeleteBtn.addEventListener('click', () => {
                if (deleteId) {
                    deleteApp(deleteId);
                    deleteModal.style.display = 'none';
                }
            });
        }
        
        // Show Delete Modal
        function showDeleteModal(id, appName) {
            deleteId = id;
            deleteAppName.textContent = appName;
            deleteModal.style.display = 'flex';
        }
        
        // Switch Tab
        function switchToTab(tabId) {
            tabBtns.forEach(btn => btn.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Reset Form
        function resetForm() {
            apkForm.reset();
            apkIdInput.value = '';
            imageIconInput.value = '';
            imagePreview.style.display = 'none';
            tanggalUpdateInput.value = new Date().toISOString().split('T')[0];
            statusPublishInput.value = 'true';
            isEditMode = false;
            formTitle.textContent = 'Tambah APK Baru';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Simpan APK';
            
            // Restore upload area
            uploadArea.innerHTML = `
                <i class="fas fa-cloud-upload-alt"></i>
                <p>Klik untuk upload icon aplikasi</p>
                <p style="font-size: 12px; margin-top: 5px;">Format: JPG, PNG, maks 2MB</p>
            `;
        }
        
        // Edit App
        function editApp(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            
            isEditMode = true;
            
            // Populate form
            apkIdInput.value = app.id;
            namaAppInput.value = app.nama_app || '';
            kategoriInput.value = app.kategori || '';
            ratingInput.value = app.rating || '';
            deskripsiInput.value = app.deskripsi || '';
            pembuatInput.value = app.pembuat || '';
            ukuranFileInput.value = app.ukuran_file || '';
            
            // Format date for input
            if (app.tanggal_update) {
                const date = app.tanggal_update.toDate ? app.tanggal_update.toDate() : new Date(app.tanggal_update);
                tanggalUpdateInput.value = date.toISOString().split('T')[0];
            }
            
            infoApkInput.value = app.info_apk || '';
            linkDownloadInput.value = app.link_download || '';
            imageIconInput.value = app.image_icon || '';
            statusPublishInput.value = app.status_publish ? 'true' : 'false';
            
            // Show image preview if exists
            if (app.image_icon) {
                previewImage.src = app.image_icon;
                imageName.textContent = 'Icon sebelumnya';
                imagePreview.style.display = 'block';
            } else {
                imagePreview.style.display = 'none';
            }
            
            // Update form title
            formTitle.textContent = 'Edit APK';
            submitBtn.innerHTML = '<i class="fas fa-save"></i> Update APK';
            
            // Switch to form tab
            switchToTab('addApk');
        }
        
        // Save App (Create or Update)
        function saveApp() {
        const ukuranValue = ukuranFileInput.value.trim();

const regex = /^[0-9.]+\s?(MB|GB)$/i;

if (!regex.test(ukuranValue)) {
    showToast('Format ukuran salah. Contoh: 120MB atau 1.5GB', 'error');
    return;
}
            const appData = {
                nama_app: namaAppInput.value.trim(),
                kategori: kategoriInput.value,
                rating: parseFloat(ratingInput.value),
                deskripsi: deskripsiInput.value.trim(),
                pembuat: pembuatInput.value.trim(),
                ukuran_file: ukuranFileInput.value.trim(),
                tanggal_update: new Date(tanggalUpdateInput.value),
                info_apk: infoApkInput.value.trim(),
                link_download: linkDownloadInput.value.trim(),
                image_icon: imageIconInput.value,
                status_publish: statusPublishInput.value === 'true',
                updated_at: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // If creating new app, add default values
            if (!isEditMode) {
                appData.view_count = 0;
                appData.download_count = 0;
                appData.created_at = firebase.firestore.FieldValue.serverTimestamp();
            }
            
            // Validate required fields
            if (!appData.nama_app || !appData.kategori || !appData.link_download) {
                showToast('Harap isi semua field yang wajib diisi', 'error');
                return;
            }
            
            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Menyimpan...';
            submitBtn.disabled = true;
            
            if (isEditMode) {
                // Update existing app
                const appId = apkIdInput.value;
                db.collection('apps').doc(appId).update(appData)
                    .then(() => {
                        showToast('APK berhasil diperbarui!', 'success');
                        resetForm();
                        switchToTab('apkList');
                    })
                    .catch(error => {
                        console.error('Error updating app:', error);
                        showToast('Gagal memperbarui APK', 'error');
                    })
                    .finally(() => {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Update APK';
                        submitBtn.disabled = false;
                    });
            } else {
                // Create new app
                db.collection('apps').add(appData)
                    .then(() => {
                        showToast('APK berhasil ditambahkan!', 'success');
                        resetForm();
                        switchToTab('apkList');
                    })
                    .catch(error => {
                        console.error('Error adding app:', error);
                        showToast('Gagal menambahkan APK', 'error');
                    })
                    .finally(() => {
                        submitBtn.innerHTML = '<i class="fas fa-save"></i> Simpan APK';
                        submitBtn.disabled = false;
                    });
            }
        }
        
        // Delete App
        function deleteApp(id) {
            db.collection('apps').doc(id).delete()
                .then(() => {
                    showToast('APK berhasil dihapus!', 'success');
                })
                .catch(error => {
                    console.error('Error deleting app:', error);
                    showToast('Gagal menghapus APK', 'error');
                });
        }
        
        // Toggle Publish Status
        function togglePublishStatus(id) {
            const app = apps.find(a => a.id === id);
            if (!app) return;
            
            const newStatus = !app.status_publish;
            
            db.collection('apps').doc(id).update({
                status_publish: newStatus,
                updated_at: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                showToast(`APK berhasil ${newStatus ? 'dipublish' : 'diunpublish'}!`, 'success');
            })
            .catch(error => {
                console.error('Error toggling publish status:', error);
                showToast('Gagal mengubah status publish', 'error');
            });
        }
        
        // Show Toast Message
        function showToast(message, type = 'success') {
            successMessage.textContent = message;
            
            // Set background color based on type
            if (type === 'error') {
                successToast.style.background = '#f44336';
            } else if (type === 'success') {
                successToast.style.background = '#4CAF50';
            }
            
            // Show toast
            successToast.style.display = 'flex';
            
            // Hide after 3 seconds
            setTimeout(() => {
                successToast.style.display = 'none';
            }, 3000);
        }
        
        // Event Listeners
        loginBtn.addEventListener('click', login);
        adminTokenInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        logoutBtn.addEventListener('click', logout);
        
        // Add shake animation to CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkLoginStatus();
            
            // Log page view
            analytics.logEvent('admin_page_view');
        });
    </script>
</body>
</html>